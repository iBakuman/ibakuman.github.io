
<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Overview TypeScript 3.0 introduced a new unknown type which is the type-safe counterpart of the any type. The main difference between unknown and any is that unknown is much less permissive than any: we have to do some form of checking before performing most operations on values of type unknown, whereas { 然而 } we don&amp;rsquo;t have to do any checks before performing operations on values of type any.'>
<title>The unknown Type in TypeScript</title><link rel='canonical' href='https://ibakuman.github.io/en/posts/typescript/typescript-evolution/038-the-unknown-type-in-typescript/'><link rel="prev" href="https://ibakuman.github.io/en/posts/typescript/typescript-evolution/037-importing-json-modules-in-typescript/" /><link rel="next" href="https://ibakuman.github.io/en/posts/typescript/typescript-evolution/039-the-show-config-compiler-option-in-typescript/" /><link rel="stylesheet" href="/css/style.min.f546ef6f4466c56e4fb7c8686e8b411e70a55207527051e5c25c20c9945b2160.css" integrity="sha256-9Ubvb0RmxW5Pt8hobotBHnClUgdScFHlwlwgyZRbIWA="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><meta property='og:title' content='The unknown Type in TypeScript'>
<meta property='og:description' content='Overview TypeScript 3.0 introduced a new unknown type which is the type-safe counterpart of the any type. The main difference between unknown and any is that unknown is much less permissive than any: we have to do some form of checking before performing most operations on values of type unknown, whereas { 然而 } we don&amp;rsquo;t have to do any checks before performing operations on values of type any.'>
<meta property='og:url' content='https://ibakuman.github.io/en/posts/typescript/typescript-evolution/038-the-unknown-type-in-typescript/'>
<meta property='og:site_name' content='iBakuman&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:published_time' content='2023-01-03T11:03:21&#43;08:00'/><meta property='article:modified_time' content='2023-01-03T11:03:21&#43;08:00'/><meta property='og:image' content='https://ibakuman.github.io/img/default.png' />
<meta name="twitter:title" content="The unknown Type in TypeScript">
<meta name="twitter:description" content="Overview TypeScript 3.0 introduced a new unknown type which is the type-safe counterpart of the any type. The main difference between unknown and any is that unknown is much less permissive than any: we have to do some form of checking before performing most operations on values of type unknown, whereas { 然而 } we don&amp;rsquo;t have to do any checks before performing operations on values of type any."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://ibakuman.github.io/img/default.png' /><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    </head>
    <body class="article-page"><script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/en/">
                
                    

                    
                        
                        <img src="/img/avatar_hu607d9502653a863721bf402ab13c6bbf_56312_300x0_resize_box_3.png" width="300"
                            height="285" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">♈</span>
                
            </figure>
            
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/en">iBakuman&#39;s Blog</a></h1>
            <h2 class="site-description">I am because you are.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a
                        href='https://github.com/ibakuman'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
            <li >
                <a href='/en/about/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                    
                    <span>About</span>
                </a>
            </li>
        
        
            <li >
                <a href='/en/archives/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                    
                    <span>Archives</span>
                </a>
            </li>
        
        
            <li >
                <a href='/en/search/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                    
                    <span>Search</span>
                </a>
            </li>
        
        
            <li >
                <a href='/en/links/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                    
                    <span>Links</span>
                </a>
            </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://ibakuman.github.io/" >中文</option>
                        
                            <option value="https://ibakuman.github.io/en/" selected>English</option>
                        
                    </select>
                </li>
            

            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/en/posts/typescript/typescript-evolution/038-the-unknown-type-in-typescript/">
                <img src="/gallery/landscape/04_hu21e79f1310d133228b33f735d4ec0be8_1556942_800x0_resize_q75_box.jpg"
                        srcset="/gallery/landscape/04_hu21e79f1310d133228b33f735d4ec0be8_1556942_800x0_resize_q75_box.jpg 800w, /gallery/landscape/04_hu21e79f1310d133228b33f735d4ec0be8_1556942_1600x0_resize_q75_box.jpg 1600w"
                        width="800"
                        height="533"
                        loading="lazy"
                        alt="Featured image of post The unknown Type in TypeScript" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/en/categories/typescript/" >
                TypeScript
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h1 class="article-title">
            <a href="/en/posts/typescript/typescript-evolution/038-the-unknown-type-in-typescript/">The unknown Type in TypeScript</a>
        </h1>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 03, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    5 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>


    <section class="article-content  auto-numbering ">
    
    
    <h2 id="overview">Overview</h2>
<p>TypeScript 3.0 introduced a new <code>unknown</code> type which is the type-safe counterpart of the <code>any</code> type.</p>
<p>The main difference between <code>unknown</code> and <code>any</code> is that <code>unknown</code> is much less permissive than <code>any</code>: we have to do some form of checking before performing most operations on values of type <code>unknown</code>, <span class="ibakuman-inline-translation">whereas<sub> { 然而 }</sub></span> we don&rsquo;t have to do any checks before performing operations on values of type <code>any</code>.</p>
<p>This post focuses on the practical aspects of the <code>unknown</code> type, including a comparison with the <code>any</code> type. For a comprehensive code example showing the semantics of the <code>unknown</code> type, check out Anders Hejlsberg&rsquo;s <a class="link" href="https://github.com/Microsoft/TypeScript/pull/24439"  target="_blank" rel="noopener"
    >original pull request</a>.</p>
<h2 id="the-any-type">The <code>any</code> Type</h2>
<p>Let&rsquo;s first look at the <code>any</code> type so that we can better understand the motivation behind introducing the <code>unknown</code> type.</p>
<p>The <code>any</code> type has been in TypeScript since the first release in 2012. It represents all possible JavaScript values — primitives, objects, arrays, functions, errors, symbols, what have you.</p>
<p>In TypeScript, every type is assignable to <code>any</code>. This makes <code>any</code> a <a class="link" href="https://en.wikipedia.org/wiki/Top_type"  target="_blank" rel="noopener"
    ><em>top type</em></a> (also known as a <em>universal supertype</em>) of the type system.</p>
<p>Here are a few examples of values that we can assign to a variable of type <code>any</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">value</span>: <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">value</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;Hello World&#34;</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">();</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s2">&#34;type&#34;</span><span class="p">);</span> <span class="c1">// OK
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>any</code> type is essentially an escape hatch from the type system. As developers, this gives us a ton of freedom: TypeScript lets us perform any operation we want on values of type <code>any</code> without having to perform any kind of checking beforehand.</p>
<p>In the above example, the <code>value</code> variable is typed as <code>any</code>. Because of that, TypeScript considers all of the following operations to be type-correct:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">value</span>: <span class="kt">any</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">value</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span><span class="p">();</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">new</span> <span class="nx">value</span><span class="p">();</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// OK
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>In many cases, this is too permissive. Using the <code>any</code> type, it&rsquo;s easy to write code that is type-correct, but problematic at runtime. We don&rsquo;t get a lot of protection from TypeScript if we&rsquo;re opting to use <code>any</code>.</p>
<p>What if there were a top type that was safe by default? This is where <code>unknown</code> comes into play.</p>
<h2 id="the-unknown-type">The <code>unknown</code> Type</h2>
<p>Just like all types are assignable to <code>any</code>, all types are assignable to <code>unknown</code>. This makes <code>unknown</code> another top type of TypeScript&rsquo;s type system (the other one being <code>any</code>).</p>
<p>Here&rsquo;s the same list of assignment examples we saw before, this time using a variable typed as <code>unknown</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">value</span>: <span class="kt">unknown</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">value</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;Hello World&#34;</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">();</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s2">&#34;type&#34;</span><span class="p">);</span> <span class="c1">// OK
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>All assignments to the <code>value</code> variable are considered type-correct.</p>
<p>What happens though when we try to assign a value of type <code>unknown</code> to variables of other types?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">value</span>: <span class="kt">unknown</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">value1</span>: <span class="kt">unknown</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value2</span>: <span class="kt">any</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value3</span>: <span class="kt">boolean</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value4</span>: <span class="kt">number</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value5</span>: <span class="kt">string</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value6</span>: <span class="kt">object</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value7</span>: <span class="kt">any</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">value8</span>: <span class="kt">Function</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span> <span class="c1">// Error
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>unknown</code> type is only assignable to the <code>any</code> type and the <code>unknown</code> type itself. <span class="ibakuman-inline-note">Intuitively, this makes sense: only a container that is capable of holding values of arbitrary types can hold a value of type <code>unknown</code>; after all, we don&rsquo;t know anything about what kind of value is stored in <code>value</code>.</span></p>
<p>Let&rsquo;s now see what happens when we try to perform operations on values of type <code>unknown</code>. Here are the same operations we&rsquo;ve looked at before:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">value</span>: <span class="kt">unknown</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">value</span><span class="p">.</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">;</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span><span class="p">();</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">new</span> <span class="nx">value</span><span class="p">();</span> <span class="c1">// Error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// Error
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>With the <code>value</code> variable typed as <code>unknown</code>, none of these operations are considered type-correct anymore. By going from <code>any</code> to <code>unknown</code>, we&rsquo;ve <span class="ibakuman-inline-translation">flipped<sub> { 改变，交换 }</sub></span> the default from permitting everything to permitting (almost) nothing.</p>
<p>This is the main value <span class="ibakuman-inline-translation">proposition<sub> { 主张，观点 }</sub></span> of the <code>unknown</code> type: TypeScript won&rsquo;t let us perform arbitrary operations on values of type <code>unknown</code>. Instead, we have to perform some <span class="ibakuman-inline-translation">sort<sub> { 类型；种类 }</sub></span> of type checking first to narrow the type of the value we&rsquo;re working with.</p>
<h2 id="narrowing-the-unknown-type">Narrowing the <code>unknown</code> Type</h2>
<p>We can narrow the <code>unknown</code> type to a more specific type in different ways, including the <code>typeof</code> operator, the <code>instanceof</code> operator, and custom type guard functions. All of these narrowing techniques contribute to TypeScript&rsquo;s <a class="link" href="https://mariusschulz.com/blog/control-flow-based-type-analysis-in-typescript"  target="_blank" rel="noopener"
    >control flow based type analysis</a>.</p>
<p>The following example illustrates how <code>value</code> has a more specific type within the two <code>if</code> statement branches:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">stringifyForLogging</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">unknown</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&#34;function&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Within this branch, `value` has type `Function`,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// so we can access the function&#39;s `name` property
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">functionName</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s2">&#34;(anonymous)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sb">`[function </span><span class="si">${</span><span class="nx">functionName</span><span class="si">}</span><span class="sb">]`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="k">instanceof</span> <span class="nb">Date</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Within this branch, `value` has type `Date`,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// so we can call the `toISOString` method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In addition to using the <code>typeof</code> or <code>instanceof</code> operators, we can also narrow the <code>unknown</code> type using a custom type guard function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A custom type guard function that determines whether
</span></span></span><span class="line"><span class="cl"><span class="cm"> * `value` is an array that only contains numbers.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">isNumberArray</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">unknown</span><span class="p">)</span><span class="o">:</span> <span class="nx">value</span> <span class="k">is</span> <span class="kt">number</span><span class="p">[]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">element</span> <span class="o">=&gt;</span> <span class="k">typeof</span> <span class="nx">element</span> <span class="o">===</span> <span class="s2">&#34;number&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">unknownValue</span>: <span class="kt">unknown</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">16</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isNumberArray</span><span class="p">(</span><span class="nx">unknownValue</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Within this branch, `unknownValue` has type `number[]`,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// so we can spread the numbers as arguments to `Math.max`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">max</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(...</span><span class="nx">unknownValue</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">max</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice how <code>unknownValue</code> has type <code>number[]</code> within the <code>if</code> statement branch although it is declared to be of type <code>unknown</code>.</p>
<h2 id="using-type-assertions-with-unknown">Using Type Assertions with <code>unknown</code></h2>
<p>In the previous section, we&rsquo;ve seen how to use <code>typeof</code>, <code>instanceof</code>, and custom type guard functions to convince the TypeScript compiler that a value has a certain type. This is the safe and recommended way to narrow values of type <code>unknown</code> to a more specific type.</p>
<p>If you want to force the compiler to trust you that a value of type <code>unknown</code> is of a given type, you can use a type assertion like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">value</span>: <span class="kt">unknown</span> <span class="o">=</span> <span class="s2">&#34;Hello World&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">someString</span>: <span class="kt">string</span> <span class="o">=</span> <span class="nx">value</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">otherString</span> <span class="o">=</span> <span class="nx">someString</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span> <span class="c1">// &#34;HELLO WORLD&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Be aware that TypeScript is not performing any special checks to make sure the type assertion is actually valid. The type checker assumes that you know better and trusts that whatever type you&rsquo;re using in your type assertion is correct.</p>
<p>This can easily lead to an error being thrown at runtime if you make a mistake and specify an incorrect type:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">value</span>: <span class="kt">unknown</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">someString</span>: <span class="kt">string</span> <span class="o">=</span> <span class="nx">value</span> <span class="kr">as</span> <span class="kt">string</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">otherString</span> <span class="o">=</span> <span class="nx">someString</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span> <span class="c1">// BOOM
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>value</code> variable holds a number, but we&rsquo;re <span class="ibakuman-inline-translation">pretending<sub> { 假装；伪装 }</sub></span> it&rsquo;s a string using the type assertion <code>value as string</code>. Be careful with type assertions!</p>
<h2 id="the-unknown-type-in-union-types">The <code>unknown</code> Type in Union Types</h2>
<p>Let&rsquo;s now look at how the <code>unknown</code> type is treated within union types. In the next section, we&rsquo;ll also look at <span class="ibakuman-inline-translation">intersection<sub> { 相交；交汇点 }</sub></span> types.</p>
<p>In a union type, <code>unknown</code> <span class="ibakuman-inline-translation">absorbs<sub> { 吸收 }</sub></span> every type. <span class="ibakuman-inline-note">This means that if any of the constituent types is <code>unknown</code>, the union type evaluates to <code>unknown</code>:</span></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">UnionType1</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// unknown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">UnionType2</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// unknown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">UnionType3</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">|</span> <span class="kt">string</span><span class="p">;</span> <span class="c1">// unknown
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">UnionType4</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">|</span> <span class="kt">number</span><span class="p">[];</span> <span class="c1">// unknown
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The one exception to this rule is <code>any</code>. If at least one of the constituent types is <code>any</code>, the union type evaluates to <code>any</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">UnionType5</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">|</span> <span class="kt">any</span><span class="p">;</span> <span class="c1">// any
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>So why does <code>unknown</code> absorb every type (aside from <code>any</code>)? Let&rsquo;s think about the <code>unknown | string</code> example. This type represents all values that are assignable to type <code>unknown</code> plus those that are assignable to type <code>string</code>. As we&rsquo;ve learned before, all types are assignable to <code>unknown</code>. This includes all strings, and therefore, <code>unknown | string</code> represents the same set of values as <code>unknown</code> itself. Hence, the compiler can simplify the union type to <code>unknown</code>.</p>
<h2 id="the-unknown-type-in-intersection-types">The <code>unknown</code> Type in Intersection Types</h2>
<p>In an intersection type, every type absorbs <code>unknown</code>. <span class="ibakuman-inline-note">This means that intersecting any type with <code>unknown</code> doesn&rsquo;t change the resulting type:</span></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">IntersectionType1</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">&amp;</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// null
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">IntersectionType2</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">&amp;</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">// undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">IntersectionType3</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">&amp;</span> <span class="kt">string</span><span class="p">;</span> <span class="c1">// string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">IntersectionType4</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">&amp;</span> <span class="kt">number</span><span class="p">[];</span> <span class="c1">// number[]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">type</span> <span class="nx">IntersectionType5</span> <span class="o">=</span> <span class="kt">unknown</span> <span class="o">&amp;</span> <span class="kt">any</span><span class="p">;</span> <span class="c1">// any
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s look at <code>IntersectionType3</code>: the <code>unknown &amp; string</code> type represents all values that are assignable to both <code>unknown</code> and <code>string</code>. Since every type is assignable to <code>unknown</code>, including <code>unknown</code> in an intersection type does not change the result. We&rsquo;re left with just <code>string</code>.</p>
<h2 id="using-operators-with-values-of-type-unknown">Using Operators with Values of Type <code>unknown</code></h2>
<p>Values of type <code>unknown</code> cannot be used as operands for most operators. This is because most operators are unlikely to produce a meaningful result if we don&rsquo;t know the types of the values we&rsquo;re working with.</p>
<p>The only operators you can use on values of type <code>unknown</code> are the four equality and <span class="ibakuman-inline-translation">inequality<sub> { 不同，不平等 }</sub></span> operators:</p>
<ul>
<li><code>===</code></li>
<li><code>==</code></li>
<li><code>!==</code></li>
<li><code>!=</code></li>
</ul>
<p>If you want to use any other operators on a value typed as <code>unknown</code>, you have to narrow the type first (or force the compiler to trust you using a type assertion).</p>
<h2 id="example-reading-json-from-localstorage">Example: Reading JSON from <code>localStorage</code></h2>
<p>Here&rsquo;s a real-world example of how we could use the <code>unknown</code> type.</p>
<p>Let&rsquo;s assume we want to write a function that reads a value from <code>localStorage</code> and deserializes it as JSON. If the item doesn&rsquo;t exist or isn&rsquo;t valid JSON, the function should return an error result; otherwise, it should deserialize and return the value.</p>
<p>Since we don&rsquo;t know what type of value we&rsquo;ll get after deserializing the persisted JSON string, we&rsquo;ll be using <code>unknown</code> as the type for the deserialized value. This means that callers of our function will have to do some form of checking before performing operations on the returned value (or <span class="ibakuman-inline-translation">resort<sub> { 诉诸，求助于 }</sub></span> to using type assertions).</p>
<p>Here&rsquo;s how we could implement that function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Result</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="p">{</span> <span class="nx">success</span>: <span class="kt">true</span><span class="p">;</span> <span class="nx">value</span>: <span class="kt">unknown</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="p">{</span> <span class="nx">success</span>: <span class="kt">false</span><span class="p">;</span> <span class="nx">error</span>: <span class="kt">Error</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">tryDeserializeLocalStorageItem</span><span class="p">(</span><span class="nx">key</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">Result</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// The item does not exist, thus return an error result
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">success</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">error</span>: <span class="kt">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`Item with key &#34;</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">&#34; does not exist`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">value</span>: <span class="kt">unknown</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// The item is not valid JSON, thus return an error result
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">success</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">error</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Everything&#39;s fine, thus return a success result
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">success</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The return type <code>Result</code> is a <a class="link" href="https://mariusschulz.com/blog/tagged-union-types-in-typescript"  target="_blank" rel="noopener"
    >tagged union type</a> (also known as a <em>discriminated union type</em>). In other languages, it&rsquo;s also known as <code>Maybe</code>, <code>Option</code>, or <code>Optional</code>. We use <code>Result</code> to cleanly model a successful and unsuccessful outcome of the operation.</p>
<p>Callers of the <code>tryDeserializeLocalStorageItem</code> function have to inspect the <code>success</code> property before attempting to use the <code>value</code> or <code>error</code> properties:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">tryDeserializeLocalStorageItem</span><span class="p">(</span><span class="s2">&#34;dark_mode&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// We&#39;ve narrowed the `success` property to `true`,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// so we can access the `value` property
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">darkModeEnabled</span>: <span class="kt">unknown</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">darkModeEnabled</span> <span class="o">===</span> <span class="s2">&#34;boolean&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// We&#39;ve narrowed the `unknown` type to `boolean`,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// so we can safely use `darkModeEnabled` as a boolean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Dark mode enabled: &#34;</span> <span class="o">+</span> <span class="nx">darkModeEnabled</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// We&#39;ve narrowed the `success` property to `false`,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// so we can access the `error` property
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><span class="ibakuman-inline-note">Note that the <code>tryDeserializeLocalStorageItem</code> function can&rsquo;t simply return <code>null</code> to signal that the deserialization failed, for the following two reasons:</span></p>
<ol>
<li>The value <code>null</code> is a valid JSON value. Therefore, we would not be able to distinguish whether we deserialized the value <code>null</code> or whether the entire operation failed because of a missing item or a syntax error.</li>
<li>If we were to return <code>null</code> from the function, we could not return the error at the same time. Therefore, callers of our function would not know why the operation failed.</li>
</ol>
<p>For the <span class="ibakuman-inline-translation">sake<sub> { 利益，好处；目的 }</sub></span> of completeness, a more <span class="ibakuman-inline-translation">sophisticated<sub> { A sophisticated machine, device, or method is more advanced or complex than others }</sub></span> alternative to this approach is to use <a class="link" href="https://dev.to/joanllenas/decoding-json-with-typescript-1jjc"  target="_blank" rel="noopener"
    >typed decoders</a> for safe JSON parsing. A decoder lets us specify the expected schema of the value we want to deserialize. If the persisted JSON <span class="ibakuman-inline-translation">turns out<sub> { 结果为 }</sub></span> not to match that schema, the decoding will fail in a well-defined manner. That way, our function always returns either a valid or a failed decoding result and we could eliminate the <code>unknown</code> type <span class="ibakuman-inline-translation">altogether<sub> { 完全地 }</sub></span>.</p>
<h2 id="references">References</h2>
<ul>
<li><a class="link" href="https://mariusschulz.com/blog/the-unknown-type-in-typescript"  target="_blank" rel="noopener"
    >The unknown Type in TypeScript — Marius Schulz</a></li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

</article>


    

    

    <aside class="related-content--wrapper">
        <h2 class="section-title">Related content</h2>
        <div class="related-content">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/en/posts/typescript/typescript-evolution/046-string-literal-types-in-typescript/">

        
            <div class="article-image">
                <img src="/gallery/landscape/18.1d6c831bbe3ac5066415b0e3b01e7d47_hu7a8b922ea914ad8a12e0fc01dcf809f5_223556_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post String Literal Types in TypeScript"
                        
                        data-hash="md5-HWyDG746xQZkFbDjsB59Rw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">String Literal Types in TypeScript</h2>
        </div>
    </a>
</article>

                
                    
<article class="has-image">
    <a href="/en/posts/typescript/typescript-evolution/045-assertion-functions-in-typescript/">

        
            <div class="article-image">
                <img src="/gallery/landscape/08.4f15a71dcde1ee073c7d3381c3255585_hufd4c43b663954d2f1b153b9f2254ca86_1202710_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post Assertion Functions in TypeScript"
                        
                        data-hash="md5-TxWnHc3h7gc8fTOBwyVVhQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Assertion Functions in TypeScript</h2>
        </div>
    </a>
</article>

                
                    
<article class="has-image">
    <a href="/en/posts/typescript/typescript-evolution/044-optional-chaining-the-operator-in-typescript/">

        
            <div class="article-image">
                <img src="/gallery/landscape/15.06c3dbd93982e483daa78dd72cef19b1_hu9990e0c65ada11c3249979cb281e5728_1046110_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post Optional Chaining: The ?. Operator in TypeScript"
                        
                        data-hash="md5-BsPb2TmC5IPap43XLO8ZsQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Optional Chaining: The ?. Operator in TypeScript</h2>
        </div>
    </a>
</article>

                
                    
<article class="has-image">
    <a href="/en/posts/typescript/typescript-evolution/043-nullish-coalescing-the-operator-in-typescript/">

        
            <div class="article-image">
                <img src="/gallery/landscape/06.419dc574ac7e8c69f7dbc91968c103ef_hu81244abf406e14dcc233313eedffeb78_1696606_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post Nullish Coalescing: The ?? Operator in TypeScript"
                        
                        data-hash="md5-QZ3FdKx&#43;jGn328kZaMED7w==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Nullish Coalescing: The ?? Operator in TypeScript</h2>
        </div>
    </a>
</article>

                
                    
<article class="has-image">
    <a href="/en/posts/typescript/typescript-evolution/042-the-omit-helper-type-in-typescript/">

        
            <div class="article-image">
                <img src="/gallery/landscape/19.ce3d7e9ebc658f78912c63e56a8e08f1_hu3c9ceb46f3c27ef42abe81330e191c65_524406_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post The Omit Helper Type in TypeScript"
                        
                        data-hash="md5-zj1&#43;nrxlj3iRLGPlao4I8Q==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">The Omit Helper Type in TypeScript</h2>
        </div>
    </a>
</article>

                
            </div>
        </div>
    </aside>


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onThemeModeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>


    
                <footer class="site-footer"><section class="copyright">
        &copy;
        
            2021 -
        
        2023 iBakuman&#39;s Blog
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#the-any-type">The <code>any</code> Type</a></li>
    <li><a href="#the-unknown-type">The <code>unknown</code> Type</a></li>
    <li><a href="#narrowing-the-unknown-type">Narrowing the <code>unknown</code> Type</a></li>
    <li><a href="#using-type-assertions-with-unknown">Using Type Assertions with <code>unknown</code></a></li>
    <li><a href="#the-unknown-type-in-union-types">The <code>unknown</code> Type in Union Types</a></li>
    <li><a href="#the-unknown-type-in-intersection-types">The <code>unknown</code> Type in Intersection Types</a></li>
    <li><a href="#using-operators-with-values-of-type-unknown">Using Operators with Values of Type <code>unknown</code></a></li>
    <li><a href="#example-reading-json-from-localstorage">Example: Reading JSON from <code>localStorage</code></a></li>
    <li><a href="#references">References</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <div class="fixed-buttons"><a href="#" class="fixed-buttons__back-to-top" class="fixed-button" title="">
                    <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
                </a><a href="#" id="fixed-buttons__view-comments" class="fixed-button" title="">
                    <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script><script type="text/javascript">window.themeConfig={"code":{"copyTitle":"Copy to clipboard"},"folding":{"maxShownLines":40}};</script><script type="text/javascript" src="/ts/main.min.3a18546ecb79abf74f4b27df66faadb0bb2e74b596d89f228e44cda88aa926fb.js" integrity="sha256-OhhUbst5q/dPSyffZvqtsLsudLWW2J8ijkTNqIqpJvs="></script>
    </body>
</html>
