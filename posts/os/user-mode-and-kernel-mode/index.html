
<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='内容大纲 小故事 张三是某科技公司的初级 Java 开发工程师（低权限），目前在 15 楼办公码代码，公司提供的资源仅有一套电脑（用户态），张三想着这一线的房价'>
<title>从根上理解用户态与内核态</title><link rel='canonical' href='https://ibakuman.github.io/posts/os/user-mode-and-kernel-mode/'><link rel="prev" href="https://ibakuman.github.io/posts/go/go-syc-primitives/" /><link rel="next" href="https://ibakuman.github.io/posts/os/memory-management/" /><link rel="stylesheet" href="/css/style.min.2dbe6aa63c3db4336151571f1f586e464d373413c7924a1e8fefc1ade77ce12f.css" integrity="sha256-Lb5qpjw9tDNhUVcfH1huRk03NBPHkkoej+/Bred84S8="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><meta property='og:title' content='从根上理解用户态与内核态'>
<meta property='og:description' content='内容大纲 小故事 张三是某科技公司的初级 Java 开发工程师（低权限），目前在 15 楼办公码代码，公司提供的资源仅有一套电脑（用户态），张三想着这一线的房价'>
<meta property='og:url' content='https://ibakuman.github.io/posts/os/user-mode-and-kernel-mode/'>
<meta property='og:site_name' content='iBakuman&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:published_time' content='2023-06-01T09:20:13&#43;08:00'/><meta property='article:modified_time' content='2023-06-01T09:28:28&#43;08:00'/><meta property='og:image' content='https://ibakuman.github.io/img/default.png' />
<meta name="twitter:title" content="从根上理解用户态与内核态">
<meta name="twitter:description" content="内容大纲 小故事 张三是某科技公司的初级 Java 开发工程师（低权限），目前在 15 楼办公码代码，公司提供的资源仅有一套电脑（用户态），张三想着这一线的房价"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://ibakuman.github.io/img/default.png' /><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    </head>
    <body class="article-page"><script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    

                    
                        
                        <img src="/img/avatar_hu607d9502653a863721bf402ab13c6bbf_56312_300x0_resize_box_3.png" width="300"
                            height="285" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">♈</span>
                
            </figure>
            
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/">iBakuman&#39;s Blog</a></h1>
            <h2 class="site-description">I am because you are.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a
                        href='https://github.com/ibakuman'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
            <li >
                <a href='/%E5%85%B3%E4%BA%8E/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                    
                    <span>关于</span>
                </a>
            </li>
        
        
            <li >
                <a href='/archives/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                    
                    <span>归档</span>
                </a>
            </li>
        
        
            <li >
                <a href='/search/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                    
                    <span>搜索</span>
                </a>
            </li>
        
        
            <li >
                <a href='/%E9%93%BE%E6%8E%A5/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                    
                    <span>链接</span>
                </a>
            </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://ibakuman.github.io/" selected>中文</option>
                        
                            <option value="https://ibakuman.github.io/en/" >English</option>
                        
                    </select>
                </li>
            

            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/os/user-mode-and-kernel-mode/">
                <img src="/gallery/landscape/24_hu02460565c68f6ee68754f9a01c400f03_406275_800x0_resize_q75_box.jpg"
                        srcset="/gallery/landscape/24_hu02460565c68f6ee68754f9a01c400f03_406275_800x0_resize_q75_box.jpg 800w, /gallery/landscape/24_hu02460565c68f6ee68754f9a01c400f03_406275_1600x0_resize_q75_box.jpg 1600w"
                        width="800"
                        height="600"
                        loading="lazy"
                        alt="Featured image of post 从根上理解用户态与内核态" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/os/" >
                OS
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h1 class="article-title">
            <a href="/posts/os/user-mode-and-kernel-mode/">从根上理解用户态与内核态</a>
        </h1>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2023/06/01 09:20:13</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 6 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>


    <section class="article-content  auto-numbering ">
    
    
    <h2 id="内容大纲">内容大纲</h2>
<p><img src="/posts/os/user-mode-and-kernel-mode/assets/v2-a528a0c54f25bf78655a3f74a09b9606_b.jpg"
	width="651"
	height="343"
	srcset="/posts/os/user-mode-and-kernel-mode/assets/v2-a528a0c54f25bf78655a3f74a09b9606_b_hu4c2b618433e46e962d82a55a946ec423_13414_480x0_resize_q75_box.jpg 480w, /posts/os/user-mode-and-kernel-mode/assets/v2-a528a0c54f25bf78655a3f74a09b9606_b_hu4c2b618433e46e962d82a55a946ec423_13414_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="189"
		data-flex-basis="455px"
	
>
</p>
<h2 id="小故事">小故事</h2>
<p>张三是某科技公司的初级 Java 开发工程师（低权限），目前在 15 楼办公码代码，公司提供的资源仅有一套电脑（用户态），张三想着这一线的房价，倍感压力山大，于是给自己定下一个目标，一定要做技术总监，在一线扎根， 奋斗 B 张三，奋斗 5 年终于当上了技术总监（高权限），之后张三搬到 30 楼，可以随时向资源部（系统调用）申请公司各种资源与获取公司的机密信息（内核态），所谓是走上人生巅峰。</p>
<p>通过这个故事，我们发现，低权限的资源范围较小，高权限的资源范围更大，所谓的「用户态与内核态只是不同权限的资源范围」。</p>
<h2 id="cpu-指令集权限">CPU 指令集权限</h2>
<p>在说用户态与内核态之前，有必要说一下 CPU 指令集，指令集是 CPU 实现软件指挥硬件执行的媒介，具体来说每一条汇编语句都对应了一条 CPU 指令，而非常非常多的 CPU 指令在一起，可以组成一个、甚至多个集合，指令的集合叫 CPU 指令集。</p>
<p>同时 CPU 指令集有权限分级，大家试想，CPU 指令集可以直接操作硬件的，要是因为指令操作的不规范，造成的错误会影响整个计算机系统的。好比你写程序，因为对硬件操作不熟悉，导致操作系统内核、及其他所有正在运行的程序，都可能会因为操作失误而受到不可挽回的错误，最后只能重启计算机才行。</p>
<p>而对于硬件的操作是非常复杂的，参数众多，出问题的几率相当大，必须谨慎的进行操作，对开发人员来说是个艰巨的任务，还会增加负担，同时开发人员在这方面也不被信任，所以操作系统内核直接屏蔽开发人员对硬件操作的可能，都不让你碰到这些 CPU 指令集。</p>
<p><img src="/posts/os/user-mode-and-kernel-mode/assets/v2-506586ddee155b7c553e3d5cf660209e_b.jpg"
	width="720"
	height="374"
	srcset="/posts/os/user-mode-and-kernel-mode/assets/v2-506586ddee155b7c553e3d5cf660209e_b_hude413d8581401bee9a40ec1aca282a8b_41440_480x0_resize_q75_box.jpg 480w, /posts/os/user-mode-and-kernel-mode/assets/v2-506586ddee155b7c553e3d5cf660209e_b_hude413d8581401bee9a40ec1aca282a8b_41440_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="192"
		data-flex-basis="462px"
	
>
</p>
<p>针对上面的需求，硬件设备商直接提供硬件级别的支持，做法就是对 CPU 指令集设置了权限，不同级别权限能使用的 CPU 指令集是有限的，以 Inter CPU 为例，Inter 把 CPU 指令集操作的权限由高到低划为 4 级：</p>
<ul>
<li>ring 0</li>
<li>ring 1</li>
<li>ring 2</li>
<li>ring 3</li>
</ul>
<p>其中 ring 0 权限最高，可以使用所有 CPU 指令集，ring 3 权限最低，仅能使用常规 CPU 指令集，不能使用操作硬件资源的 CPU 指令集，比如 IO 读写、网卡访问、申请内存都不行，Linux 系统仅采用 ring 0 和 ring 3 这 2 个权限。</p>
<p><img src="/posts/os/user-mode-and-kernel-mode/assets/v2-7eb07a96e11e6da0cafd15edc82faa96_b.jpg"
	width="720"
	height="424"
	srcset="/posts/os/user-mode-and-kernel-mode/assets/v2-7eb07a96e11e6da0cafd15edc82faa96_b_hu5110bd7a7bf23a4c35089103d1363514_43300_480x0_resize_q75_box.jpg 480w, /posts/os/user-mode-and-kernel-mode/assets/v2-7eb07a96e11e6da0cafd15edc82faa96_b_hu5110bd7a7bf23a4c35089103d1363514_43300_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="169"
		data-flex-basis="407px"
	
>
</p>
<p>高情商</p>
<ul>
<li>ring 0 被叫做内核态，完全在操作系统内核中运行</li>
<li>ring 3 被叫做用户态，在应用程序中运行</li>
</ul>
<p>低情商</p>
<ul>
<li>执行内核空间的代码，具有 ring 0 保护级别，有对硬件的所有操作权限，可以执行所有 CPU 指令集，访问任意地址的内存，在内核模式下的任何异常都是灾难性的，将会导致整台机器停机</li>
<li>在用户模式下，具有 ring 3 保护级别，代码没有对硬件的直接控制权限，也不能直接访问地址的内存，程序是通过调用系统接口 (System Call APIs) 来达到访问硬件和内存，在这种保护模式下，即时程序发生崩溃也是可以恢复的，在电脑上大部分程序都是在，用户模式下运行的</li>
</ul>
<h2 id="用户态与内核态">用户态与内核态</h2>
<p>通关了 CPU 指令集权限，现在再说用户态与内核态就十分简单了，用户态与内核态的概念就是 CPU 指令集权限的区别，进程中要读写 IO，必然会用到 ring 0 级别的 CPU 指令集，而此时 CPU 的指令集操作权限只有 ring 3，为了可以操作 ring 0 级别的 CPU 指令集， CPU 切换指令集操作权限级别为 ring 0，CPU 再执行相应的 ring 0 级别的 CPU 指令集（内核代码），执行的内核代码会使用当前进程的内核栈。</p>
<p>PS：每个进程都有两个栈，分别是用户栈与内核栈，对应用户态与内核态的使用</p>
<h2 id="用户态与内核态的空间">用户态与内核态的空间</h2>
<p>在内存资源上的使用，操作系统对用户态与内核态也做了限制，每个进程创建都会分配「虚拟空间地址」（不懂可以参考我的另一篇文章 “15 分钟！一文帮小白搞懂操作系统之内存”），以 Linux32 位操作系统为例，它的寻址空间范围是 <code>4G</code>（2 的 32 次方），而操作系统会把虚拟控制地址划分为两部分，一部分为内核空间，另一部分为用户空间，高位的 <code>1G</code>（从虚拟地址 0xC0000000 到 0xFFFFFFFF）由内核使用，而低位的 <code>3G</code>（从虚拟地址 0x00000000 到 0xBFFFFFFF）由各个进程使用。</p>
<p><img src="/posts/os/user-mode-and-kernel-mode/assets/v2-1870a0008929b2a66e2462db14200213_b.jpg"
	width="431"
	height="282"
	srcset="/posts/os/user-mode-and-kernel-mode/assets/v2-1870a0008929b2a66e2462db14200213_b_hued7d69d27a3c193b3de3cc1f3a27a9d6_12445_480x0_resize_q75_box.jpg 480w, /posts/os/user-mode-and-kernel-mode/assets/v2-1870a0008929b2a66e2462db14200213_b_hued7d69d27a3c193b3de3cc1f3a27a9d6_12445_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="152"
		data-flex-basis="366px"
	
>
</p>
<ul>
<li>用户态：只能操作 <code>0-3G</code> 范围的低位虚拟空间地址</li>
<li>内核态：<code>0-4G</code> 范围的虚拟空间地址都可以操作，尤其是对 <code>3-4G</code> 范围的高位虚拟空间地址必须由内核态去操作</li>
<li>补充：<code>3G-4G</code> 部分大家是共享的（指所有进程的内核态逻辑地址是共享同一块内存地址），是内核态的地址空间，这里存放在整个内核的代码和所有的内核模块，以及内核所维护的数据</li>
</ul>
<p>每个进程的 <code>4G</code> 虚拟空间地址，高位 <code>1G</code> 都是一样的，即内核空间。只有剩余的 <code>3G</code> 才归进程自己使用，换句话说就是， 高位 <code>1G</code> 的内核空间是被所有进程共享的！</p>
<p>最后做个小结，我们通过指令集权限区分用户态和内核态，还限制了内存资源的使用，操作系统为用户态与内核态划分了两块内存空间，给它们对应的指令集使用</p>
<h2 id="用户态与内核态的切换">用户态与内核态的切换</h2>
<p>相信大家都听过这样的话「用户态和内核态切换的开销大」，但是它的开销大在那里呢？简单点来说有下面几点</p>
<ul>
<li>保留用户态现场（上下文、寄存器、用户栈等）</li>
<li>复制用户态参数，用户栈切到内核栈，进入内核态</li>
<li>额外的检查（因为内核代码对用户不信任）</li>
<li>执行内核态代码</li>
<li>复制内核态代码执行结果，回到用户态</li>
<li>恢复用户态现场（上下文、寄存器、用户栈等）</li>
</ul>
<p>实际上操作系统会比上述的更复杂，这里只是个大概，我们可以发现一次切换经历了「用户态 -&gt; 内核态 -&gt; 用户态」。</p>
<p>用户态要主动切换到内核态，那必须要有入口才行，实际上内核态是提供了统一的入口，下面是 Linux 整体架构图</p>
<p><img src="/posts/os/user-mode-and-kernel-mode/assets/v2-62ff353fcfb90639ae2ec7aa5006b73c_b.jpg"
	width="720"
	height="530"
	srcset="/posts/os/user-mode-and-kernel-mode/assets/v2-62ff353fcfb90639ae2ec7aa5006b73c_b_hu749c7f2c3969de67953ce945fcad0a6e_32703_480x0_resize_q75_box.jpg 480w, /posts/os/user-mode-and-kernel-mode/assets/v2-62ff353fcfb90639ae2ec7aa5006b73c_b_hu749c7f2c3969de67953ce945fcad0a6e_32703_1024x0_resize_q75_box.jpg 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="135"
		data-flex-basis="326px"
	
>
</p>
<p>从上图我们可以看出来通过系统调用将 Linux 整个体系分为用户态和内核态，为了使应用程序访问到内核的资源，如 CPU、内存、I/O，内核必须提供一组通用的访问接口，这些接口就叫系统调用。</p>
<p>库函数就是屏蔽这些复杂的底层实现细节，减轻程序员的负担，从而更加关注上层的逻辑实现，它对系统调用进行封装，提供简单的基本接口给程序员。</p>
<p>Shell 顾名思义，就是外壳的意思，就好像把内核包裹起来的外壳，它是一种特殊的应用程序，俗称命令行。Shell 也是可编程的，它有标准的 Shell 语法，符合其语法的文本叫 Shell 脚本，很多人都会用 Shell 脚本实现一些常用的功能，可以提高工作效率。</p>
<p>最后来说说，什么情况会导致用户态到内核态切换</p>
<ul>
<li>系统调用：用户态进程主动切换到内核态的方式，用户态进程通过系统调用向操作系统申请资源完成工作，例如 fork（）就是一个创建新进程的系统调用，系统调用的机制核心使用了操作系统为用户特别开放的一个中断来实现，如 Linux 的 int 80h 中断，也可以称为软中断</li>
<li>异常：当 CPU 在执行用户态的进程时，发生了一些没有预知的异常，这时当前运行进程会切换到处理此异常的内核相关进程中，也就是切换到了内核态，如缺页异常</li>
<li>中断：当 CPU 在执行用户态的进程时，外围设备完成用户请求的操作后，会向 CPU 发出相应的中断信号，这时 CPU 会暂停执行下一条即将要执行的指令，转到与中断信号对应的处理程序去执行，也就是切换到了内核态。如硬盘读写操作完成，系统会切换到硬盘读写的中断处理程序中执行后边的操作等。</li>
</ul>
<h2 id="关联好文章推荐">关联好文章推荐</h2>
<ul>
<li><a class="link" href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/J2XA86nKyodeTyTU2Q6W0g"  target="_blank" rel="noopener"
    >15 分钟！一文帮小白搞懂操作系统之内存</a></li>
<li><a class="link" href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/jhOSjVyRA6rNKqVT2pKMIQ"  target="_blank" rel="noopener"
    >进程、线程与协程傻傻分不清？一文带你吃透！</a></li>
</ul>
<h2 id="原文地址">原文地址</h2>
<ul>
<li><a class="link" href="https://zhuanlan.zhihu.com/p/388057431"  target="_blank" rel="noopener"
    >从根上理解用户态与内核态</a></li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 2023/06/01 09:28:28
        </span>
    </section></footer>

</article>


    

    

    <aside class="related-content--wrapper">
        <h2 class="section-title">相关文章</h2>
        <div class="related-content">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/posts/os/memory-management/">

        
            <div class="article-image">
                <img src="/gallery/landscape/28.3d3810f889a49ce73e89c7268d405a62_hubb8073e5e8dea6b644ad1c33059b37ce_1206472_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post 操作系统内存管理"
                        
                        data-hash="md5-PTgQ&#43;ImknOc&#43;iccmjUBaYg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">操作系统内存管理</h2>
        </div>
    </a>
</article>

                
            </div>
        </div>
    </aside>


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onThemeModeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

                <footer class="site-footer"><section class="copyright">
        &copy;
        
            2021 -
        
        2023 iBakuman&#39;s Blog
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#内容大纲">内容大纲</a></li>
    <li><a href="#小故事">小故事</a></li>
    <li><a href="#cpu-指令集权限">CPU 指令集权限</a></li>
    <li><a href="#用户态与内核态">用户态与内核态</a></li>
    <li><a href="#用户态与内核态的空间">用户态与内核态的空间</a></li>
    <li><a href="#用户态与内核态的切换">用户态与内核态的切换</a></li>
    <li><a href="#关联好文章推荐">关联好文章推荐</a></li>
    <li><a href="#原文地址">原文地址</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <div class="fixed-buttons"><a href="#" class="fixed-buttons__back-to-top" class="fixed-button" title="">
                    <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
                </a><a href="#" id="fixed-buttons__view-comments" class="fixed-button" title="">
                    <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script><script type="text/javascript">window.themeConfig={"code":{"copyTitle":"Copy to clipboard"},"folding":{"maxShownLines":40}};</script><script type="text/javascript" src="/ts/main.min.3a18546ecb79abf74f4b27df66faadb0bb2e74b596d89f228e44cda88aa926fb.js" integrity="sha256-OhhUbst5q/dPSyffZvqtsLsudLWW2J8ijkTNqIqpJvs="></script>
    </body>
</html>
