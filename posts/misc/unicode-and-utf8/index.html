
<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='前言 在日常开发的过程中，有关 Unicode 、UTF-8 的问题并不常出现，但在阅读技术文章或源码时出现频率就比较高了。笔者最近刚好就在开发时遇到了和 Unicode 相关'>
<title>一次性弄懂 Unicode 和 UTF-8</title><link rel='canonical' href='https://ibakuman.github.io/posts/misc/unicode-and-utf8/'><link rel="prev" href="https://ibakuman.github.io/posts/leetcode/problems/0121-best-time-to-buy-and-sell-stock/" /><link rel="next" href="https://ibakuman.github.io/posts/leetcode/problems/0055-jump-game/" /><link rel="stylesheet" href="/css/style.min.f546ef6f4466c56e4fb7c8686e8b411e70a55207527051e5c25c20c9945b2160.css" integrity="sha256-9Ubvb0RmxW5Pt8hobotBHnClUgdScFHlwlwgyZRbIWA="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><meta property='og:title' content='一次性弄懂 Unicode 和 UTF-8'>
<meta property='og:description' content='前言 在日常开发的过程中，有关 Unicode 、UTF-8 的问题并不常出现，但在阅读技术文章或源码时出现频率就比较高了。笔者最近刚好就在开发时遇到了和 Unicode 相关'>
<meta property='og:url' content='https://ibakuman.github.io/posts/misc/unicode-and-utf8/'>
<meta property='og:site_name' content='iBakuman&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='UTF-8' /><meta property='article:published_time' content='2023-05-17T18:56:45&#43;08:00'/><meta property='article:modified_time' content='2023-05-17T19:25:09&#43;08:00'/><meta property='og:image' content='https://ibakuman.github.io/img/default.png' />
<meta name="twitter:title" content="一次性弄懂 Unicode 和 UTF-8">
<meta name="twitter:description" content="前言 在日常开发的过程中，有关 Unicode 、UTF-8 的问题并不常出现，但在阅读技术文章或源码时出现频率就比较高了。笔者最近刚好就在开发时遇到了和 Unicode 相关"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://ibakuman.github.io/img/default.png' /><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    </head>
    <body class="article-page"><script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    

                    
                        
                        <img src="/img/avatar_hu607d9502653a863721bf402ab13c6bbf_56312_300x0_resize_box_3.png" width="300"
                            height="285" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">♈</span>
                
            </figure>
            
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/">iBakuman&#39;s Blog</a></h1>
            <h2 class="site-description">I am because you are.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a
                        href='https://github.com/ibakuman'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
            <li >
                <a href='/%E5%85%B3%E4%BA%8E/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                    
                    <span>关于</span>
                </a>
            </li>
        
        
            <li >
                <a href='/archives/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                    
                    <span>归档</span>
                </a>
            </li>
        
        
            <li >
                <a href='/search/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                    
                    <span>搜索</span>
                </a>
            </li>
        
        
            <li >
                <a href='/%E9%93%BE%E6%8E%A5/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                    
                    <span>链接</span>
                </a>
            </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://ibakuman.github.io/" selected>中文</option>
                        
                            <option value="https://ibakuman.github.io/en/" >English</option>
                        
                    </select>
                </li>
            

            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/misc/unicode-and-utf8/">
                <img src="/gallery/landscape/25_hu0a3309c019aba12b8d679d09b57cc9da_1259768_800x0_resize_q75_box.jpg"
                        srcset="/gallery/landscape/25_hu0a3309c019aba12b8d679d09b57cc9da_1259768_800x0_resize_q75_box.jpg 800w, /gallery/landscape/25_hu0a3309c019aba12b8d679d09b57cc9da_1259768_1600x0_resize_q75_box.jpg 1600w"
                        width="800"
                        height="500"
                        loading="lazy"
                        alt="Featured image of post 一次性弄懂 Unicode 和 UTF-8" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/misc/" >
                Misc
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h1 class="article-title">
            <a href="/posts/misc/unicode-and-utf8/">一次性弄懂 Unicode 和 UTF-8</a>
        </h1>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2023/05/17 18:56:45</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 9 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>


    <section class="article-content  auto-numbering ">
    
    
    <h2 id="前言">前言</h2>
<p>在日常开发的过程中，有关 <code>Unicode</code> 、<code>UTF-8</code> 的问题并不常出现，但在阅读技术文章或源码时出现频率就比较高了。笔者最近刚好就在开发时遇到了和 <code>Unicode</code> 相关的问题，发现自己对这方面的基础知识并没有充分掌握。因此将相关知识梳理出来，帮助大家理解清楚 <code>Unicode</code> 和 <code>UTF-8</code>。</p>
<h2 id="字符集">字符集</h2>
<h3 id="什么是字符集">什么是字符集？</h3>
<p>字符集（Character set）是多个字符的集合，并且每个字符都拥有唯一的编号（即码点，Code Point）。不同的字符集所包含的字符个数不同，常见的字符集有：<code>ASCII</code> 字符集、<code>GB2312</code> 字符集、<code>BIG5</code> 字符集、<code>GB18030</code> 字符集、<code>Unicode</code> 字符集等。</p>
<p>在没有计算机之前，大部分信息以文本的形式存在，那么如何将文本存储到计算机中呢？</p>
<p>我们知道，在计算机中是通过<strong>二进制值</strong>来表示信息的，每个二进制位（bit）都有 <code>0</code> 和 <code>1</code> 两种状态。而计算机中存储的最小单位就是字节（Byte），由 8 个二进制位组成，那么就可以表示 2^8=256 种状态。</p>
<p>利用这 256 个二进制值，我们可以将字符转换为数值存储到计算机中，假设我们规定：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">A: 00000000
</span></span><span class="line"><span class="cl">B: 00000001
</span></span><span class="line"><span class="cl">C: 00000010
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样有了一对一的映射关系后，我们就可以把文本 <code>ABC</code> 用 <code>00000000 00000001 00000010</code> 存储到计算机中。这样的一个包含字符 <code>ABC</code> 的映射集合就是我们自定义的” 字符集 “。</p>
<h3 id="ascii-码">ASCII 码</h3>
<p>我们在上一节介绍字符集时自定义了一个只包含 <code>ABC</code> 三个字母的字符集，仅仅作为例子可以，但是应用到实际的话显然是不够用的，因为既没有将所有的字母写入，也无法映射空格或标点符号等字符。</p>
<p>为了解决这个问题，在上世纪六十年代，美国制定了一套字符编码，即 <code>ASCII</code> 码（American Standard Code for Information Interchange，美国信息交换标准代码，详见<a class="link" href="https://www.wikiwand.com/zh-hans/ASCII"  target="_blank" rel="noopener"
    >维基百科 - ASCII</a>），将英语字符与二进制值进行一一对应，一直沿用至今。</p>
<p>标准 <code>ASCII</code> 码使用 <code>7</code> 位二进制数（剩下的首位二进制为 <code>0</code>）来表示所有的大写和小写字母，数字 0 到 9、标点符号，以及在美式英语中使用的特殊控制字符。比如空格 <code>SPACE</code> 的十进制值是 32（二进制 <code>00100000</code> ），大写的字母 <code>A</code> 的十进制值是 65（二进制 <code>01000001</code>），如下图所示。</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/image.png-1.webp"
	width="738"
	height="212"
	srcset="/posts/misc/unicode-and-utf8/assets/image.png-1_hu49fc7c78b27e271aa3c03da5b65274e1_14582_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/image.png-1_hu49fc7c78b27e271aa3c03da5b65274e1_14582_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="348"
		data-flex-basis="835px"
	
>
</p>
<p><code>ASCII</code> 码对于美国这种使用英语作为母语的国家是够用了，但是对于使用其他语言的国家，128 个二进制值仍不足以表示所有字符，于是一些国家决定利用字节中的闲置最高位编入新的字符，这样一来这些国家使用了 8 位二进制值就可以表示最多 256 个字符。</p>
<p>然而这又带来了新的问题，即使不同国家都使用 256 个字符的编码方式，但是同一个二进制值在不同的国家却表示不同的字符，例如 130 在法语中表示 é ，在希伯来语编码中却代表了字母 Gimel (ג)，就会造成乱码。</p>
<p>为了解决多语言环境下产生的编码冲突问题，<code>Unicode</code> 应运而生。</p>
<h3 id="unicode">Unicode</h3>
<p><code>Unicode</code> 将世界上的所有字符囊括其中，并为每一个字符定义唯一的代码（即一个整数），称作<strong>码点</strong>（Code Point）。</p>
<p>码点的范围是 <code>U+0000</code>~<code>U+10FFFF</code>，<code>U+</code> 表示这是 <code>Unicode</code> 字符集，后面跟着一个<strong>十六进制数</strong>。</p>
<p>目前的 <code>Unicode</code> 字符分为 17 组编排，每个编组存放 <code>65536</code> （即 2^16）个码点，称为一个<strong>平面</strong>（Plane）。</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/image.png-4.webp"
	width="1710"
	height="706"
	srcset="/posts/misc/unicode-and-utf8/assets/image.png-4_huf78a0c88ffd55186e56b11a56f1ba239_74878_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/image.png-4_huf78a0c88ffd55186e56b11a56f1ba239_74878_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="242"
		data-flex-basis="581px"
	
>
</p>
<p>例如，<code>U+0041</code> 表示英语的大写字母 <code>A</code>，<code>U+4E25</code> 表示汉字<code>严</code>，它们都位于基本多文种平面。详见<a class="link" href="https://link.juejin.cn/?target=https%3A%2F%2Fzh.wikipedia.org%2Fzh-hans%2FUnicode"  title="https://zh.wikipedia.org/zh-hans/Unicode"
     target="_blank" rel="noopener"
    >维基百科 - Unicode</a>。</p>
<h2 id="字符编码">字符编码</h2>
<h3 id="什么是字符编码">什么是字符编码？</h3>
<p>字符，即字母、数字、运算符号、标点符号和其他符号，以及一些功能性符号。</p>
<p>编码，根据词性的不同，表示的含义也不同：</p>
<ul>
<li>作为动词时，表示信息从一种形式或格式转换为另一种形式的过程，例如将大写字母 <code>A</code> 转换为二进制值 <code>1000001</code> 的过程就是一个编码动作；</li>
<li>作为名词时，有两种表示
<ol>
<li>表示将字符转为机器码的方案，例如 <code>ASCII</code> 编码、<code>UTF-8</code> 编码等；</li>
<li>另一种是表示将字符转换后得到的机器码，例如 <code>100001</code> 就是 <code>A</code> 的编码。</li>
</ol>
</li>
</ul>
<p>因此在阅读有关字符编码的文章时，应该根据当前上下文来判断编码一词的含义。</p>
<h3 id="unicode-的实现方式">Unicode 的实现方式</h3>
<p><code>Unicode</code> 字符集解决了多语种间的冲突问题，但是并没有规定如何将编码存储到计算机中。</p>
<p>以大写字母 A 为例，它的 Unicode 码点为 <code>U+0041</code> ，转换成二进制为 <code>1000001</code> ，需要使用 1 个字节存储；汉字 严 的 Unicode 码点为 <code>U+4E25</code> ，转换成二进制为 <code>1001110 00100101</code>，需要使用 2 个字节存储。而位于编号更靠后的平面中的字符，转换成二进制数字就会更长，最高位 <code>U+10FFFF</code> 甚至<strong>需要 3 个字节来存储</strong>。</p>
<p>在这种情况下所面临的问题就是，计算机无法得知某个字符究竟<strong>需要多少字节存储</strong>，假设统一使用 3 个字节来存储 1 个字符，那么存储位于基本多文种平面的字符，就会有 2 个字节的所有位都是 0 ，会造成存储资源的浪费。</p>
<p>为了解决存储方式上存在的问题，就出现了 <code>UTF</code> (Unicode 转换格式，Unicode Transformation Formats，简称 UTF）系列的编码方式。下面介绍一下几种常见的实现方式。</p>
<h3 id="utf-8-编码">UTF-8 编码</h3>
<p><code>UTF-8</code> 编码是<strong>互联网上使用最广泛</strong>的一种 <code>Unicode</code> 的实现方式。</p>
<p>它是一种变长编码。对于 <code>ASCII</code> 字符仍用 7 位编码表示，占用一个字节（首位补 0）；而遇到其他 <code>Unicode</code> 字符时，将按一定算法转换，每个字符使用 <strong>1 到 4 个字节编码</strong>。</p>
<p>编码规则也很简单：</p>
<ol>
<li>编码后的字节长度为 1 时，<strong>首位为 0</strong> ，剩余 7 位为 <code>Unicode</code> 码点值。因此码点值的范围是 0~128，在<strong>这个范围内 ASCII 编码和 UTF-8 是相同的</strong>；</li>
<li>编码后的字节长度 n 大于 1 时，首个字节的前 n 位都是 1（即，有几个 1 就表示总共有几个字节），n+1 位为 0 ，其他字节的前两位均为 10，剩余的位为 <code>Unicode</code> 码点值。</li>
</ol>
<blockquote>
<p>在 Unicode 中，一般使用频率较高的都是编码值较小的字符（即大部分都位于基本多文种平面），并且 Unicode 中前 128 个字符也是和 ASCII 码的二进制值相同。UTF-8 采用的这种变长编码规则，可以尽可能的节省内存空间，并且完全兼容 ASCII 码，因此，它逐渐成为电子邮件、网页及其他存储或传送文字优先采用的编码方式。</p>
</blockquote>
<p><img src="/posts/misc/unicode-and-utf8/assets/image.png-2.webp"
	width="2020"
	height="538"
	srcset="/posts/misc/unicode-and-utf8/assets/image.png-2_hua17044ad1caab87bd0f508a49c91be15_58274_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/image.png-2_hua17044ad1caab87bd0f508a49c91be15_58274_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="375"
		data-flex-basis="901px"
	
>
</p>
<p>以大写字母 <code>A</code> 为例，码点为 <code>U+0041</code> ，编码后为 1 个字节，和 <code>ASCII</code> 编码下的存储方式相同，都是 <code>01000001</code> ；</p>
<p>而对于汉字<code>严</code>，码点为 <code>U+4E25</code>，编码后为 3 个字节。码点值转换为二进制是 <code>1001110 00100101</code>，共 15 位，由转换关系表可知它落在 3 字节序列中，因此转换后的格式应该是 <code>1110xxxx 10xxxxxx 10xxxxxx</code>，将码点值按顺序补位后得到 <code>11100100 10111000 10100101</code>，这就是 <code>UTF-8</code> 编码后的汉字严，过程如下图：</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/WX20220906-105351.png.webp"
	width="800"
	height="270"
	srcset="/posts/misc/unicode-and-utf8/assets/WX20220906-105351.png_hu1498b9303f30cb11e9a52dd21f49d224_16268_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/WX20220906-105351.png_hu1498b9303f30cb11e9a52dd21f49d224_16268_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="296"
		data-flex-basis="711px"
	
>
</p>
<p>我们来验证下上面的转换过程。</p>
<p>首先准备两个 txt 文件，第一个文件里只有字母 A，第二个文件里只有汉字 严，保存文件时以 <code>UTF-8</code> 格式保存。这里笔者用的是 Mac 系统，可以直接在命令行中执行 <code>echo</code> 命令输出到 txt 文件中，默认的编码格式就是 <code>UTF-8</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;A&#39;</span> &gt; <span class="s1">&#39;A.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;严&#39;</span> &gt; <span class="s1">&#39;严.txt&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后打开命令行，使用 <code>hexdump</code> 命令查看文件：</p>
<blockquote>
<p>hexdump 命令可以以 ASCII、八进制、十进制或十六进制显示文件内容。</p>
</blockquote>
<p><img src="/posts/misc/unicode-and-utf8/assets/image.png.webp"
	width="1102"
	height="406"
	srcset="/posts/misc/unicode-and-utf8/assets/image.png_hu1a55facba30561cf7e49a2dfd4b9d3bf_22402_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/image.png_hu1a55facba30561cf7e49a2dfd4b9d3bf_22402_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="271"
		data-flex-basis="651px"
	
>
</p>
<p>第一列的两个值是文件中的字符偏移量，我们的重点在第二列。显然 A.txt 的结果是符合预期的，因为 <code>ASCII</code> 码在 <code>UTF-8</code> 的编码方式下和 Unicode 码点值是相同的。而严.txt 的结果不太一样，显然是经过了变长的编码算法转换后得到的。</p>
<p>我们将 <code>e4 b8 a5</code> 的十六进制值转换一下。可以使用在线进制转换工具 <a class="link" href="https://tool.oschina.net/hexconvert/"  target="_blank" rel="noopener"
    >tool.oschina.net/hexconvert/</a> 或者直接将每一个十六进制数转换为二进制进行组合，转换结果就是：</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/image.png-3.webp"
	width="1440"
	height="418"
	srcset="/posts/misc/unicode-and-utf8/assets/image.png-3_hu2c47a8c3beb0dc5ecae2fbebc6b162af_22610_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/image.png-3_hu2c47a8c3beb0dc5ecae2fbebc6b162af_22610_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="344"
		data-flex-basis="826px"
	
>
</p>
<p>这样就和上文我们转换的结果相同了。</p>
<h3 id="utf-16-编码">UTF-16 编码</h3>
<p><code>UTF-16</code> 也是一种变长编码，它将 <code>Unicode</code> 码点映射为 16 位长的整数（即码元）的序列，用于数据存储或传递。<code>Unicode</code> 字符的码点，使用 1 个或者 2 个 16 位长的码元来表示。</p>
<blockquote>
<p>码元（Code Unit，也称 “代码单元”）是指一个已编码的文本中具有最短的比特组合的单元。对于 UTF-8 来说，码元是 8bit ；对于 UTF-16 来说，码元是 16bit；对于 UTF-32 来说，码元是 32bit。</p>
</blockquote>
<p><code>Unicode</code> 的基本多文种平面码点范围是 <code>U+0000</code> 到 <code>U+FFFF</code> ，不过从 <code>U+D800</code> 到 <code>U+DFFF</code> 之间的码位区段是<strong>永久保留不映射到 Unicode 字符的</strong>，因此 UTF-16 就利用保留下来的 <code>U+D800</code> 到 <code>U+DFFF</code> 区块的码位来对辅助平面的字符的码位进行编码。</p>
<p>编码规则如下：</p>
<ul>
<li>对于从 <code>U+0000</code> 到 <code>U+D7FF</code> 以及 <code>U+E000</code> 到 <code>U+FFFF</code> 的码位：UTF-16 编码这个范围内的码位为 16bit 的单个码元，数值就等价于对应的码位；</li>
<li>对于从 <code>U+10000</code> 到 <code>U+10FFFF</code> 的码位：这个范围是补充平面中的码位，在 UTF-16 中被编码为两个 16bit 的码元（即 32 位，4 字节），称作 <em>代理对</em>。</li>
</ul>
<p>![(assets/image.png-5.webp)</p>
<p>编码过程如下：</p>
<ol>
<li>码位减去 <code>0x10000</code>，得到的值的范围为 20bit 的 <code>0...0xFFFFF</code>。</li>
<li>高位的 10bit 的值（从左往右数第 1 位到第 10 位）加上 <code>0xD800</code> 后得到第一个码元，称作<strong>前导代理</strong>，值的范围是 <code>0xD800...0xDBFF</code> 。</li>
<li>低位的 10bit 的值（从左往右数第 11 位到第 20 位）加上 <code>0xDC00</code> 后得到第二个码元，称作<strong>后尾代理</strong>，值的范围是 <code>0xDC00...0xDFFF</code>。</li>
</ol>
<p>以补充平面的字符 🐶 为例，它的码点值是 <strong>U+1F436：</strong></p>
<blockquote>
<p><a class="link" href="https://link.juejin.cn/?target=https%3A%2F%2Funicode-table.com%2Fcn%2F"  title="https://unicode-table.com/cn/"
     target="_blank" rel="noopener"
    ></a><a class="link" href="https://link.juejin.cn/?target=https%3A%2F%2Funicode-table.com%2Fcn%2F"  title="https://unicode-table.com/cn/"
     target="_blank" rel="noopener"
    >unicode-table.com/cn/</a> 可以在这个网站中查找某个 Unicode 字符的码点值</p>
</blockquote>
<ul>
<li>第一步，<code>0x1F436</code> 减去 <code>0x10000</code>，得到 <code>0xF436</code> ，转为二进制位为 <code>11110100 00110110</code></li>
<li>高位 10bit 为 <code>00 0011 1101</code>（不足的位补 <code>0</code>），转为 16 进制是 <code>0x003D</code> ，加上 <code>0xD800</code> 后为 <code>0xD83D</code></li>
<li>低位 10bit 为 <code>00 0011 0110</code>，转为 16 进制是 <code>0x0036</code> ，加上 <code>0xDC00</code> 后为 <code>0xDC36</code></li>
</ul>
<p>因此最终转换后的值应该是 <code>D8 3D DC 36</code>。整个过程可以看下图：</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/WX20220906-142132.png.webp"
	width="800"
	height="464"
	srcset="/posts/misc/unicode-and-utf8/assets/WX20220906-142132.png_hu13649cce3656e1a0dfb4cddc4a739d37_22150_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/WX20220906-142132.png_hu13649cce3656e1a0dfb4cddc4a739d37_22150_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="172"
		data-flex-basis="413px"
	
>
</p>
<p>同样地，我们来验证下上面的转换过程。</p>
<p>将单个字符存储在 txt 文件中，选择 <code>UTF-16 BE</code> 的编码方式进行保存。</p>
<blockquote>
<p>UTF-16 BE 是一种字节序，有关字节序的知识见下一节。</p>
</blockquote>
<p>同样使用 <code>hexdump</code> 命令查看：</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/image.png-1.webp"
	width="738"
	height="212"
	srcset="/posts/misc/unicode-and-utf8/assets/image.png-1_hu49fc7c78b27e271aa3c03da5b65274e1_14582_480x0_resize_q75_h2_box_2.webp 480w, /posts/misc/unicode-and-utf8/assets/image.png-1_hu49fc7c78b27e271aa3c03da5b65274e1_14582_1024x0_resize_q75_h2_box_2.webp 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="348"
		data-flex-basis="835px"
	
>
</p>
<p>符合推测结果。</p>
<h3 id="utf-字节序">UTF 字节序</h3>
<p>字节序也叫尾序或端序，详细介绍可见 <a class="link" href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F"  target="_blank" rel="noopener"
    >维基百科 - 字节序</a>。</p>
<p>顾名思义，字节序就是指字节之间的顺序，在传输 or 存储过程中如果<strong>最小编码单元超过 1 个字节</strong>，需要指定<strong>编码单元内的字节间顺序</strong>。因此对于 <code>UTF-8</code> 不存在字节序的问题，而 <code>UTF-16</code> 时就需要考虑字节序的问题了。</p>
<p>字节序有两个通用规则：</p>
<ol>
<li>小端序（little endian）：多位数的低位放在较小的地址处，高位放在较大的地址处。</li>
<li>大端序（big endian）：和小端序相反，多位数的高位放在较小的地址处，低位放在较大的地址处。</li>
</ol>
<p>以上一节的文本为例，下图为字符🐶在 <code>UTF-16</code> 编码下使用不同端序时在内存中的存储结果：</p>
<p><img src="/posts/misc/unicode-and-utf8/assets/t.png"
	width="715"
	height="292"
	srcset="/posts/misc/unicode-and-utf8/assets/t_hu1421f54c72f3385337c1d64ee913aa98_37601_480x0_resize_box_3.png 480w, /posts/misc/unicode-and-utf8/assets/t_hu1421f54c72f3385337c1d64ee913aa98_37601_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
	
		class="gallery-image"
		data-flex-grow="244"
		data-flex-basis="587px"
	
>
</p>
<p>网络传输中一般采用大端序，也被称之为<strong>网络字节序</strong>，或<strong>网络序</strong>。在网络传输时，不存在字节序列问题。而在解码时由于 cpu 硬件差异，存在字节序问题，所以需要通过 <code>BOM</code>(byte order mark) 标识来标记字节顺序，通常出现在字节流的开头。</p>
<h3 id="utf-8-与-utf-16-对比">UTF-8 与 UTF-16 对比</h3>
<p>综上所述，我们来对比一下 UTF-8 和 UTF-16。</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>标题</th>
<th>UTF-8</th>
<th>UTF-16</th>
</tr>
</thead>
<tbody>
<tr>
<td>兼容性</td>
<td>好，完美兼容 ASCII 码，字符空间足够大</td>
<td>UTF-16 能表示的字符数有 6w 多，看起来很多，但是实际上目前 Unicode 收录的字符已经达到 9w 个字符，早已超过 UTF-16 的存储范围</td>
</tr>
<tr>
<td>字节序</td>
<td>不存在字节序问题，信息交换便捷</td>
<td>存在大小端字节序问题，信息交换时可能出现问题</td>
</tr>
<tr>
<td>容错率</td>
<td>高，个别字节的错误不会导致整个文档的不可用，字符边界明显</td>
<td>低，局部的字节错误，可能导致所有后续字符全部错乱</td>
</tr>
<tr>
<td>效率</td>
<td>变长字节导致计算字符数和执行索引等操作效率都不高</td>
<td>双字节，在计算字符串长度、执行索引操作时速度很快</td>
</tr>
<tr>
<td>多语种环境</td>
<td>ASCII 码只占用一个字节，而对于 CJK 文字来说负担太大，一个字符占用 3 个字节</td>
<td>刚好和前者相反</td>
</tr>
</tbody>
</table></div>
<p>无论是 UTF-8 和 UTF-16/32 都各有优缺点，因此<strong>选择的时候应当立足于实际的应用场景</strong>。</p>
<h2 id="总结">总结</h2>
<p>本文主要介绍了字符编码和字符集、<code>Unicode</code> 编码以及 <code>Unicode</code> 的实现方式 —— <code>UTF-8</code> 和 <code>UTF-16</code> 两种编码方式的相关知识。需要注意的是 <code>Unicode</code> 编码一般指的是 <code>Unicode</code> 字符集，而 <code>UTF-8</code> 和 <code>UTF-16</code> 编码指的是 <code>Unicode</code> 的实现方式，希望本文能够帮助大家理解清楚这些知识。</p>
<h2 id="原文地址">原文地址</h2>
<ul>
<li><a class="link" href="https://juejin.cn/post/7152699935660441636"  target="_blank" rel="noopener"
    >一次性弄懂 Unicode 和 UTF-8</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/utf-8/">UTF-8</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 2023/05/17 19:25:09
        </span>
    </section></footer>

</article>


    

    


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onThemeModeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

                <footer class="site-footer"><section class="copyright">
        &copy;
        
            2021 -
        
        2023 iBakuman&#39;s Blog
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#前言">前言</a></li>
    <li><a href="#字符集">字符集</a>
      <ol>
        <li><a href="#什么是字符集">什么是字符集？</a></li>
        <li><a href="#ascii-码">ASCII 码</a></li>
        <li><a href="#unicode">Unicode</a></li>
      </ol>
    </li>
    <li><a href="#字符编码">字符编码</a>
      <ol>
        <li><a href="#什么是字符编码">什么是字符编码？</a></li>
        <li><a href="#unicode-的实现方式">Unicode 的实现方式</a></li>
        <li><a href="#utf-8-编码">UTF-8 编码</a></li>
        <li><a href="#utf-16-编码">UTF-16 编码</a></li>
        <li><a href="#utf-字节序">UTF 字节序</a></li>
        <li><a href="#utf-8-与-utf-16-对比">UTF-8 与 UTF-16 对比</a></li>
      </ol>
    </li>
    <li><a href="#总结">总结</a></li>
    <li><a href="#原文地址">原文地址</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <div class="fixed-buttons"><a href="#" class="fixed-buttons__back-to-top" class="fixed-button" title="">
                    <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
                </a><a href="#" id="fixed-buttons__view-comments" class="fixed-button" title="">
                    <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script><script type="text/javascript">window.themeConfig={"code":{"copyTitle":"Copy to clipboard"},"folding":{"maxShownLines":40}};</script><script type="text/javascript" src="/ts/main.min.3a18546ecb79abf74f4b27df66faadb0bb2e74b596d89f228e44cda88aa926fb.js" integrity="sha256-OhhUbst5q/dPSyffZvqtsLsudLWW2J8ijkTNqIqpJvs="></script>
    </body>
</html>
