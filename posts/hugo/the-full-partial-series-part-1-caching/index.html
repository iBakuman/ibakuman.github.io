
<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Overview Partials are one of the most used and maintained Hugo template files. They are our components, our includes, our bits, and recently even became our functions. In this series we’re not going to cover the basics of partials such as their “context” as it’s already discussed in depth here . Nope for this Christmas,'>
<title>The Full Partial Series Part 1 - Caching!</title><link rel='canonical' href='https://ibakuman.github.io/posts/hugo/the-full-partial-series-part-1-caching/'><link rel="prev" href="https://ibakuman.github.io/posts/leetcode/problems/1763-longest-nice-substring/" /><link rel="next" href="https://ibakuman.github.io/posts/javascript/an-article-to-help-you-understand-es6-module-system/" /><link rel="stylesheet" href="/css/style.min.f546ef6f4466c56e4fb7c8686e8b411e70a55207527051e5c25c20c9945b2160.css" integrity="sha256-9Ubvb0RmxW5Pt8hobotBHnClUgdScFHlwlwgyZRbIWA="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><meta property='og:title' content='The Full Partial Series Part 1 - Caching!'>
<meta property='og:description' content='Overview Partials are one of the most used and maintained Hugo template files. They are our components, our includes, our bits, and recently even became our functions. In this series we’re not going to cover the basics of partials such as their “context” as it’s already discussed in depth here . Nope for this Christmas,'>
<meta property='og:url' content='https://ibakuman.github.io/posts/hugo/the-full-partial-series-part-1-caching/'>
<meta property='og:site_name' content='iBakuman&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='Build Website' /><meta property='article:published_time' content='2022-10-04T13:17:23&#43;08:00'/><meta property='article:modified_time' content='2022-10-04T13:17:23&#43;08:00'/><meta property='og:image' content='https://ibakuman.github.io/img/default.png' />
<meta name="twitter:title" content="The Full Partial Series Part 1 - Caching!">
<meta name="twitter:description" content="Overview Partials are one of the most used and maintained Hugo template files. They are our components, our includes, our bits, and recently even became our functions. In this series we’re not going to cover the basics of partials such as their “context” as it’s already discussed in depth here . Nope for this Christmas,"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://ibakuman.github.io/img/default.png' /><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    </head>
    <body class="article-page"><script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    

                    
                        
                        <img src="/img/avatar_hu607d9502653a863721bf402ab13c6bbf_56312_300x0_resize_box_3.png" width="300"
                            height="285" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">♈</span>
                
            </figure>
            
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/">iBakuman&#39;s Blog</a></h1>
            <h2 class="site-description">I am because you are.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a
                        href='https://github.com/ibakuman'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
            <li >
                <a href='/%E5%85%B3%E4%BA%8E/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                    
                    <span>关于</span>
                </a>
            </li>
        
        
            <li >
                <a href='/archives/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                    
                    <span>归档</span>
                </a>
            </li>
        
        
            <li >
                <a href='/search/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                    
                    <span>搜索</span>
                </a>
            </li>
        
        
            <li >
                <a href='/%E9%93%BE%E6%8E%A5/' >
                    
                    
                    
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                    
                    <span>链接</span>
                </a>
            </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://ibakuman.github.io/" selected>中文</option>
                        
                            <option value="https://ibakuman.github.io/en/" >English</option>
                        
                    </select>
                </li>
            

            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/hugo/the-full-partial-series-part-1-caching/">
                <img src="/gallery/landscape/01_hu984801500a3ee8d5189999f9716a0882_2696078_800x0_resize_q75_box.jpg"
                        srcset="/gallery/landscape/01_hu984801500a3ee8d5189999f9716a0882_2696078_800x0_resize_q75_box.jpg 800w, /gallery/landscape/01_hu984801500a3ee8d5189999f9716a0882_2696078_1600x0_resize_q75_box.jpg 1600w"
                        width="800"
                        height="446"
                        loading="lazy"
                        alt="Featured image of post The Full Partial Series Part 1 - Caching!" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/hugo/" >
                Hugo
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h1 class="article-title">
            <a href="/posts/hugo/the-full-partial-series-part-1-caching/">The Full Partial Series Part 1 - Caching!</a>
        </h1>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2022/10/04 13:17:23</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 4 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>


    <section class="article-content  auto-numbering ">
    
    
    <h2 id="overview">Overview</h2>
<p>Partials are one of the most used and maintained Hugo template files. They are our components, our includes, our bits, and recently even became our functions.</p>
<p>In this series we’re not going to cover the basics of <a class="link" href="https://gohugo.io/templates/partials/#readout"  target="_blank" rel="noopener"
    >partials</a> such as their “context” as it’s already discussed in depth <a class="link" href="https://www.regisphilibert.com/blog/2018/02/hugo-the-scope-the-context-and-the-dot/"  target="_blank" rel="noopener"
    >here</a> .</p>
<p>Nope for this Christmas, we’re going to push partials way beyond your basic includes. We’re going to see how you can have Hugo cache your partials to speed up the build time, use partials as functions, and finally see the best organizing and commenting practices to make sure they last!</p>
<p>So without further ado, let’s <span class='ibakuman-inline-translation'>kick off<sub> { 开场 }</sub></span> the series with partial’s own caching solution: <a class="link" href="https://gohugo.io/functions/partialcached/"  target="_blank" rel="noopener"
    ><code>partialCached</code></a></p>
<h2 id="why-use-partialcached">Why use partialCached?</h2>
<p>As you know the purpose of a partial is to wrap frequently addressed template code inside one reusable file.</p>
<blockquote>
<p>除了名词用法，address 也可以作为动词使用喔！用来表示「应付、处理（deal with）」，后面接上需要处理的事物，像是 issue（议题）、problem（问题）、concern（担忧）、question（问题）&hellip;等。
所以影片中提到 &hellip;it&rsquo;s addressing the big issues of the day about people in depressed areas.，字面意思其实就是「这本书也处理到现今经济萧条区人民经济上的大问题」喔！</p>
</blockquote>
<p>If like me you hate <code>copying/pasting</code> identical lines of code accross your projects, you must be using partials a lot!</p>
<p>The markup rendered by your partial might be the same on a majority of pages and differ only for a few, or it could be completely different from one page to the next. The latter scenario will rarely benefit from caching so let’s focus on the first one.</p>
<p>Think about your header for example.</p>
<p>Your header will almost always print the same markup! Same logo, same URL pointing to home, same navigation, same social links. It will be printed throughout the site on every single page.</p>
<p>If your Hugo project needs to create one thousand HTML files, then, on every build, Hugo will have to look for your menu configuration, your social configuration and <span class="ibakuman-inline-note">process the exact same markup a thousand times</span>.</p>
<p>With a <code>partialCached</code> you can inform Hugo that this piece of code will never change, and can <span class='ibakuman-inline-translation'>therefor<sub> { 因此 }</sub></span> be processed once, cached and reused:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">partialCached</span><span class="w"> </span><span class="s">&#34;header.html&#34;</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>That’s 999 times when Hugo will not have to bother interpreting that partial’s code. Depending on the complexity of your navigation, <strong>you potentially saved a lot of precious milliseconds</strong> ⏱️!</p>
<p>But is our header really going to be the same for every page?</p>
<p>No as it most likely will underline or highlight some links from the main menu depending on where your visitors are on the site.</p>
<p>Our Hugo menu code might contain something like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="na">.Site.Menus.main</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">a</span> 
</span></span><span class="line"><span class="cl">    <span class="na">class</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">$currentPage</span><span class="na">.Section</span><span class="w"> </span><span class="na">.Page.Section</span><span class="w"> </span><span class="cp">}}</span><span class="s"> active </span><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="na">href</span><span class="o">=</span><span class="s">&#34;</span><span class="cp">{{</span><span class="w"> </span><span class="na">.URL</span><span class="w"> </span><span class="cp">}}</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{</span><span class="w"> </span><span class="na">.Name</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above code is pretty <span class='ibakuman-inline-translation'>straightforward<sub> { 简单明了的 }</sub></span>. Our projects bears a simple five item menu, each linking to a section of the site. In order to make <strong>Blog</strong> menu item appear active when visiting a page from the Blog section, we compare the <code>$currentPage.Section</code> with the menu item’s own <code>.Page.Section</code>.</p>
<p>Now with our current <code>{{ partialCached &quot;header.html&quot; . }}</code>,<span class="ibakuman-inline-note"> Hugo will run this if clause once and apply its result to every subsquent pages it builds regardless of their section. That’s not good!</span></p>
<p>Enter partials’ <code>variants</code>.</p>
<h2 id="partial-variants">Partial variants</h2>
<p>We know that the header is only going to change five times, depending on the current page’s <code>.Section</code>. We therefor need to tell Hugo to cache a different <code>variant</code> of the partial depending on this factor.</p>
<p><span class='ibakuman-inline-translation'>Contrary to<sub> { 跟…相反 }</sub></span> <code>partial</code>, <code>partialCached</code> list of arguments is not limited to context.</p>
<p>In our simple use case, the obvious variant is the current page <code>.Section</code> so we can drop this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">partialCached</span><span class="w"> </span><span class="s">&#34;navigation.html&#34;</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="na">.Section</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>🎉 That’s 995 times when Hugo will not have to bother interpreting that partial’s code.</p>
<p>Good. That’s one variant down, but what if something else has to change, and it’s not connected to the section? For example on this very site, the social links are very <span class='ibakuman-inline-translation'>prominent<sub> { 突出的; 显著的 }</sub></span> in the contact page, so when on that page, the header does not “repeat” them.</p>
<p>Code goes something like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">ne</span><span class="w"> </span><span class="na">.Layout</span><span class="w"> </span><span class="s">&#34;contact&#34;</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">site</span><span class="na">.Socials</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">{{/* you got the picture */}}</span>
</span></span><span class="line"><span class="cl">  <span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>So we need 2 variants now, the <code>.Section</code> variant and the <code>Is it the contact page?</code> variant.</p>
<p>Lucky for us, the number of variants argument is limitless, so here we go:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">partialCached</span><span class="w"> </span><span class="s">&#34;navigation.html&#34;</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="na">.Section</span><span class="w"> </span><span class="s">&#34;contact&#34;</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>That was for easy reading but let’s face it, you’ll most likely need something more « dynamic »</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">$layout</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cond</span><span class="w"> </span><span class="o">(</span><span class="k">eq</span><span class="w"> </span><span class="na">.Layout</span><span class="w"> </span><span class="s">&#34;contact&#34;</span><span class="o">)</span><span class="w"> </span><span class="s">&#34;contact&#34;</span><span class="w"> </span><span class="s">&#34;other&#34;</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">partialCached</span><span class="w"> </span><span class="s">&#34;navigation.html&#34;</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="na">.Section</span><span class="w"> </span><span class="nx">$layout</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>🎉 That’s 994 times when Hugo will not have to bother interpreting that partial’s code.</p>
<h2 id="stepping-variants-up-a-notch-">Stepping variants up a notch 💪</h2>
<p>Let’s dive into something a little bit more complex.</p>
<p>Our blog has an « authors » box. We have three authors on site, so this box will either list one, or a combination of them based on an array in our post’s Front Matter. It’s safe to say, that out of our 1000 articles, many will share the same combination.</p>
<p>Here, the ideal variant would therefor be our list of authors in a consistent order, so we’d be tempted to just run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">partialCached</span><span class="w"> </span><span class="s">&#34;authors-box.html&#34;</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="na">.Params.authors</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Unfortunately <span class='ibakuman-inline-translation'>for the time being<sub> { 目前 }</sub></span>, variant arguments passed to <code>partialCached</code> must be <strong>strings</strong> 🤷.</p>
<blockquote>
<p>Since Hugo 0.61.0 you can use any object as cache key(s), not just strings.</p>
</blockquote>
<p>In order to pass this requirement, we need to turn this array into a string before using it, and the safest way to do this is, as often, using <a class="link" href="https://gohugo.io/functions/printf/#readout"  target="_blank" rel="noopener"
    ><code>printf</code></a> and the right <a class="link" href="https://golang.org/pkg/fmt/#hdr-Printing"  target="_blank" rel="noopener"
    >verb</a> . Personally I like <code>%x</code> as it will produce a base-16 string representation of a value, regardless of its type.</p>
<p>Assuming with have:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">authors:
</span></span><span class="line"><span class="cl">  - Bud Parr
</span></span><span class="line"><span class="cl">  - Frank Taillandier
</span></span><span class="line"><span class="cl">  - Régis Philibert
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">$variant</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">printf</span><span class="w"> </span><span class="s">&#34;%x&#34;</span><span class="w"> </span><span class="na">.Params.authors</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>🖨️👇 <code>[4275642050617272 4672616e6b205461696c6c616e64696572 52c3a9676973205068696c6962657274]</code></p>
<p>Now we have a string we can pass as a partial variant:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go-html-template" data-lang="go-html-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="na">.Params.authors</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{</span><span class="w"> </span><span class="nx">$authors</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sort</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{</span><span class="w"> </span><span class="nx">$variant</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">printf</span><span class="w"> </span><span class="s">&#34;%x&#34;</span><span class="w"> </span><span class="nx">$authors</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl">    <span class="cp">{{</span><span class="w"> </span><span class="nx">partialCached</span><span class="w"> </span><span class="s">&#34;authors-box.html&#34;</span><span class="w"> </span><span class="na">.</span><span class="w"> </span><span class="nx">$variant</span><span class="w"> </span><span class="cp">}}</span>
</span></span><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="cp">}}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Why sorting the authors?</p>
<p>If our partial always lists the authors in the same alphabetical order, we should make sure the random order the editors might have added them in does not create unnecessary cached variants.</p>
<p>warning</p>
<p>This variant solution works for simple slices and maps. You should run some tests before using it with more complex data structure.</p>
<p>With all of the above, we can be sure that Hugo will only build the author’s box, once per combination of authors.</p>
<h2 id="what-about-languages-">What about languages? 🇫🇷🇬🇧</h2>
<p>In a multilingual context, and thinking back to our header partial, we might have a language switch in there and be tempted to add yet another variant:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{{ partialCached &#34;navigation.html&#34; . .Section .Lang }}
</span></span></code></pre></td></tr></table>
</div>
</div><p><span class="ibakuman-inline-note">But you don’t have to do that, as Hugo will build as many cached partial as languages by default</span>. So in our current use case, Hugo will compute our header’s markup ten times.</p>
<p>🧮</p>
<p>The golden rules to figure out the number of partial « compute » is:</p>
<p><code>partial X variants X languages</code></p>
<h2 id="improving-your-build-time-">Improving your build time ⏱️</h2>
<p>For the projects you have built yourself, it might be fairly easy to go though your <code>partials</code> directory and quickly identify those which could be cached. But for projects you inherited or built a long time ago, there are two CLI flags you can run. <code>hugo --templateMetrics --templateMetricsHints</code>.</p>
<p>The first flag ran alone is already very helpful as it will list every template file and give you information about the duration of their building. <span class="ibakuman-inline-note">Not everything in there can be cached though, only partials</span>.</p>
<p>The second one adds an extra column which prints that file’s “cache potential” in percentage.</p>
<p>Those commands will help identify any big <span class='ibakuman-inline-translation'>clogs<sub> { 堵塞; 阻塞 }</sub></span>, but you should always ask yourself these three questions:</p>
<ol>
<li>How complex is the partial and what its <span class='ibakuman-inline-translation'>cumulative<sub> { 渐增的；累计的 }</sub></span> duration might add up to.</li>
<li>How many times will it be processed compared to its potential number of variants.</li>
<li>How can I adapt my code to make it easily cacheable. (<span class="ibakuman-inline-note">identifying variants early on will save a lot of refactoring later</span>)</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p><span class="ibakuman-inline-note">When building a new Hugo project or maintaining one you should always keep in mind that every line of code could slow your build. Let Hugo do the heavy-lifting a few times rather than every time!</span></p>
<p>So go look for those partial files, make up your own variants and start saving time and money by heavily making those <code>partialCached</code>!</p>
<h2 id="references">References</h2>
<ul>
<li><a class="link" href="https://www.regisphilibert.com/blog/2019/12/hugo-partial-series-part-1-caching-with-partialcached/"  target="_blank" rel="noopener"
    >The original article address</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/build-website/">Build Website</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

</article>


    

    

    <aside class="related-content--wrapper">
        <h2 class="section-title">相关文章</h2>
        <div class="related-content">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/posts/hugo/auto-number-headings-toc-in-hugo-pages/">

        
            <div class="article-image">
                <img src="/gallery/landscape/19.ce3d7e9ebc658f78912c63e56a8e08f1_hu3c9ceb46f3c27ef42abe81330e191c65_524406_250x150_fill_q75_box_smart1.jpg"
                        width="250"
                        height="150"
                        loading="lazy"
                        alt="Featured image of post Auto number Headings &amp; TOC in Hugo Pages"
                        
                        data-hash="md5-zj1&#43;nrxlj3iRLGPlao4I8Q==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Auto number Headings &amp; TOC in Hugo Pages</h2>
        </div>
    </a>
</article>

                
            </div>
        </div>
    </aside>


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onThemeModeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>


    
                <footer class="site-footer"><section class="copyright">
        &copy;
        
            2021 -
        
        2023 iBakuman&#39;s Blog
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#why-use-partialcached">Why use partialCached?</a></li>
    <li><a href="#partial-variants">Partial variants</a></li>
    <li><a href="#stepping-variants-up-a-notch-">Stepping variants up a notch 💪</a></li>
    <li><a href="#what-about-languages-">What about languages? 🇫🇷🇬🇧</a></li>
    <li><a href="#improving-your-build-time-">Improving your build time ⏱️</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <div class="fixed-buttons"><a href="#" class="fixed-buttons__back-to-top" class="fixed-button" title="">
                    <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
                </a><a href="#" id="fixed-buttons__view-comments" class="fixed-button" title="">
                    <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script><script type="text/javascript">window.themeConfig={"code":{"copyTitle":"Copy to clipboard"},"folding":{"maxShownLines":40}};</script><script type="text/javascript" src="/ts/main.min.3a18546ecb79abf74f4b27df66faadb0bb2e74b596d89f228e44cda88aa926fb.js" integrity="sha256-OhhUbst5q/dPSyffZvqtsLsudLWW2J8ijkTNqIqpJvs="></script>
    </body>
</html>
